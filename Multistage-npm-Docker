# ------------ STAGE 1: BUILD THE JAVA APP ------------
    FROM maven:3.9-openjdk-17 AS builder

    # Set working directory inside the container
    WORKDIR /app
    
    # Copy only the Maven descriptor first (pom.xml) to leverage Docker cache for dependencies
    COPY pom.xml .

    # (Optional) Download dependencies separately for caching
    RUN mvn dependency:go-offline

    # Copy source code
    COPY src ./src
    
    # Build the project and create the .jar file
    RUN mvn clean package
    
# ------------ STAGE 2: RUN THE JAVA APP ------------
    FROM openjdk:17-jdk-slim
    
    # Set working directory for runtime
    WORKDIR /app
    
    # Copy only the built JAR from the builder stage
    COPY --from=builder /app/target/*.jar app.jar
    
    # Expose app port (e.g., if Spring Boot uses 8080)
    EXPOSE 8080
    
    # Run the app
    CMD ["java", "-jar", "app.jar"]
    